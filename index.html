<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sfida</title>
  <link href="https://fonts.cdnfonts.com/css/ex-padrian" rel="stylesheet">

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{ --ink:#4a3f30; }
    html,body{height:100%}
    body{
      margin:0; padding:40px 20px;
      font-family:'Ex Padrian', Georgia, serif;
      /* Fallback “carta chiara” sempre visibile */
      background:
        radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%);
      color:var(--ink); text-align:center;
      display:flex; flex-direction:column; justify-content:center;
      min-height:100vh; box-sizing:border-box;
      text-shadow:1px 1px 2px rgba(255,255,255,0.6);
    }
    body.bg-loaded{
      background-repeat:no-repeat;
      background-size:cover;
      background-position:center center;
    }
    h1{ font-size:3.5em; margin:0 0 .2em; font-weight:400; }
    p.description{ font-size:1.3em; margin:.2em 0 1.5em; font-style:italic; }
    p.challenge{ font-size:2.2em; font-weight:700; margin:0 0 1.5em; line-height:1.3; }
    .actions{ margin-bottom:2em; }
    button{
      font:inherit; padding:.6em 1.2em; border-radius:25px;
      border:1px solid #c8bca8; background:#fff; cursor:pointer; transition:transform .1s;
    }
    button:hover{ transform:translateY(-2px); }
    p.thanks{ font-size:1.2em; font-style:italic; margin-top:auto; }
  </style>
</head>
<body>
  <h1>Sfida</h1>
  <p class="description">Un piccolo gioco per rendere la festa ancora più speciale.</p>
  <p class="challenge" id="challengeText"></p>

  <div class="actions">
    <button id="newBtn" type="button">Nuova sfida</button>
  </div>

  <p class="thanks">Grazie per partecipare e rendere questo giorno indimenticabile.</p>

  <script>
    // ——— Sfondi: prova nome/estensione/case diversi, con cache-buster
    (function setBackground(){
      const candidates = [
        "sfondo.jpg","sfondo.jpeg","sfondo.png",
        "Sfondo.jpg","Sfondo.jpeg","Sfondo.png"
      ];
      let i = 0;
      const img = new Image();
      function next(){
        if(i >= candidates.length) return; // nessuno trovato, resta il fallback
        img.onload = () => {
          // Imposta come background e aggiungi classe per cover/position
          document.body.style.backgroundImage =
            `radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),`+
            `radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),`+
            `linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%), url('${img.src}')`;
          document.body.classList.add('bg-loaded');
        };
        img.onerror = () => { i++; next(); };
        // cache-buster per evitare vecchie versioni in cache
        img.src = candidates[i] + '?v=' + Date.now();
      }
      next();
    })();

    // ——— Logica sfida
    const challenges = [
      "Vai a fare un brindisi con uno sconosciuto.",
      "Racconta agli sposi il tuo più bel ricordo con loro.",
      "Balla la tua canzone preferita per almeno un minuto.",
      "Scatta una foto divertente con qualcuno che non conosci.",
      "Fai un complimento sincero a due persone che non conosci."
    ];
    const STORAGE_KEY = "sfida_generica";

    function loadSaved(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      try { return JSON.parse(raw); } catch { return null; }
    }
    function save(index){ localStorage.setItem(STORAGE_KEY, JSON.stringify({ index })); }
    function pickRandom(exclude){
      let idx;
      do { idx = Math.floor(Math.random() * challenges.length); }
      while (idx === exclude && challenges.length > 1);
      return idx;
    }

    (function init(){
      let saved = loadSaved();
      let index = (saved && Number.isInteger(saved.index)) ? saved.index : pickRandom();
      if(!saved) save(index);

      const challengeText = document.getElementById('challengeText');
      challengeText.textContent = challenges[index];

      document.getElementById('newBtn').addEventListener('click', () => {
        index = pickRandom(index);
        save(index);
        challengeText.textContent = challenges[index];
      });
    })();
  </script>
</body>
</html>
