<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sfida</title>

  <!-- Font Ex Padrian -->
  <link href="https://fonts.cdnfonts.com/css/ex-padrian" rel="stylesheet">
  <!-- Preload dello sfondo -->
  <link rel="preload" as="image" href="sfondo.jpg" />
  <!-- Preload facoltativo dell'audio (se presente) -->
  <link rel="preload" as="audio" href="musica.mp3" />

  <style>
    :root { --ink:#4a3f30; }
    html, body { height: 100%; margin:0; }

    body{
      color:var(--ink);
      font-family:'Ex Padrian', Georgia, serif;
      display:flex;
      flex-direction:column;
      background:
        radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%);
      text-align:center;
      text-shadow:1px 1px 2px rgba(255,255,255,0.6);
      min-height:100vh;
    }

    body.bg-loaded{
      background:
        linear-gradient(rgba(255,255,255,0.15), rgba(255,255,255,0.15)), /* overlay leggero */
        url("sfondo.jpg") no-repeat center center fixed,
        radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%);
      background-size: cover;
    }

    .spacer { flex:1; } /* spazio sopra per posizionare il blocco più in basso */
    main.stack{
      margin-bottom: 10vh;     /* regola l’altezza del blocco (più su/giù) */
      padding: 20px;
      max-width: min(820px, 100%);
      margin-left: auto; margin-right: auto;
      display: grid; gap: 10px;
    }

    h1{
      font-size: clamp(32px, 6vw, 56px);
      margin: 0 0 .2em 0;
      font-weight: 400;
    }
    p.description{
      font-size: clamp(16px, 3.2vw, 22px);
      margin: 0 0 1em 0;
      font-style: italic;
    }

    /* Testo sfida + animazione */
    p.challenge{
      font-size: clamp(22px, 4.8vw, 34px);
      font-weight: 700;
      line-height: 1.25;
      margin: 0 0 1em 0;
      transition: opacity .35s ease, transform .35s ease;
    }
    p.challenge.fade-out{
      opacity: 0;
      transform: translateY(8px);
    }
    @keyframes fadeInUp{
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    p.challenge.fade-in{
      animation: fadeInUp .35s ease forwards;
    }

    .actions{ display:flex; justify-content:center; gap:10px; margin-bottom: 1em; flex-wrap:wrap; }
    button{
      font: inherit;
      padding: .6em 1.2em;
      border-radius: 25px;
      border: 1px solid #c8bca8;
      background: #fff;
      cursor: pointer;
      transition: transform .1s;
    }
    button:hover{ transform: translateY(-2px); }

    p.thanks{
      font-size: clamp(14px, 3vw, 18px);
      font-style: italic;
      margin: 0;
    }

    /* Pulsante musica “secondario” */
    .btn-ghost{
      background: rgba(255,255,255,0.7);
      border: 1px solid #d9d0c1;
    }
  </style>
</head>
<body>
  <div class="spacer"></div>

  <main class="stack">
    <h1>Sfida</h1>
    <p class="description">Un piccolo gioco per rendere la festa ancora più speciale.</p>
    <p class="challenge" id="challengeText"></p>

    <div class="actions">
      <button id="newBtn" type="button">Nuova sfida</button>
      <button id="musicBtn" type="button" class="btn-ghost" style="display:none;">Musica ▷</button>
    </div>

    <p class="thanks">Grazie per partecipare e rendere questo giorno indimenticabile.</p>
  </main>

  <!-- Audio di sottofondo (carica "musica.mp3" accanto a index.html) -->
  <audio id="bgMusic" src="musica.mp3" loop preload="auto"></audio>

  <script>
    // Precarico lo sfondo e applico quando pronto
    (function preloadBg(){
      const img = new Image();
      img.onload = () => document.body.classList.add('bg-loaded');
      img.src = 'sfondo.jpg';
    })();

    // Lista definitiva delle 20 sfide
    const challenges = [
      "Fai un brindisi con un tavolo che non conosci.",
      "Scatta una foto divertente con due persone appena conosciute.",
      "Alza il bicchiere e proponi un brindisi insieme al tuo tavolo gridando “Viva gli sposi!”.",
      "Con il tuo tavolo scegliete un gesto elegante o divertente (es. un brindisi simultaneo, alzare le mani, fare un cuore con le dita) e fatelo insieme guardando gli sposi.",
      "Crea con il tuo tavolo una posa buffa e fate una foto di gruppo da mostrare agli sposi.",
      "Invita qualcuno a ballare una canzone che non conosci.",
      "Trova un invitato che ha lo stesso drink o piatto e fate un selfie brindando.",
      "Fai un applauso improvvisato con il tuo tavolo e coinvolgi chi ti sta intorno.",
      "Impara il nome di tre persone nuove e salutale per nome più tardi.",
      "Racconta agli sposi un tuo piccolo ricordo felice legato a loro.",
      "Condividi al tavolo una curiosità su di te che pochi sanno.",
      "Registra un breve video di auguri (10–15s) con qualcuno del tuo tavolo.",
      "Fai ridere il tuo tavolo con una battuta o un brindisi simpatico.",
      "Impara e mostra un passo di danza nuovo con un invitato per almeno 15 secondi.",
      "Trova un invitato con il tuo stesso colore di outfit e fate una foto.",
      "Fai un mini brindisi “alla spontaneità” con il tuo vicino di sedia.",
      "Scatta la foto di un dettaglio che ti rende felice oggi e conservala per gli sposi.",
      "Inizia al tuo tavolo una catena di abbracci o strette di mano: passa il gesto al vicino finché gira tutto il tavolo.",
      "Coinvolgi due tavoli vicini e organizzate insieme un mini “coro” di auguri agli sposi.",
      "Insegna a un invitato una parola nella tua lingua o dialetto."
    ];

    // Local storage e random
    const STORAGE_KEY = "sfida_generica";
    const loadSaved = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "null"); }
      catch { return null; }
    };
    const save = (index) => localStorage.setItem(STORAGE_KEY, JSON.stringify({ index }));
    const pickRandom = (exclude) => {
      let idx;
      do { idx = Math.floor(Math.random() * challenges.length); }
      while (idx === exclude && challenges.length > 1);
      return idx;
    };

    // Animazione cambio testo (rispetta prefers-reduced-motion)
    function animateSwap(el, newText){
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(reduce){
        el.textContent = newText;
        return;
      }
      el.classList.add('fade-out');
      el.addEventListener('transitionend', function handler(){
        el.removeEventListener('transitionend', handler);
        el.textContent = newText;
        el.classList.remove('fade-out');
        el.classList.add('fade-in');
        setTimeout(() => el.classList.remove('fade-in'), 350);
      }, { once: true });
    }

    (function init(){
      // Sfida iniziale
      let saved = loadSaved();
      let index = (saved && Number.isInteger(saved.index)) ? saved.index : pickRandom();
      if (!saved) save(index);

      const challengeText = document.getElementById("challengeText");
      animateSwap(challengeText, challenges[index]);

      document.getElementById("newBtn").addEventListener("click", () => {
        index = pickRandom(index);
        save(index);
        animateSwap(challengeText, challenges[index]);
      });

      // Musica di sottofondo
      const audio = document.getElementById('bgMusic');
      const btnMusic = document.getElementById('musicBtn');

      // Se il file audio esiste, abilito il bottone
      audio.addEventListener('error', () => {
        // nascondi il bottone se il file non si carica (404 o assente)
        btnMusic.style.display = 'none';
      });
      audio.addEventListener('canplay', () => {
        btnMusic.style.display = 'inline-block';
      });

      // Impostazioni audio iniziali
      audio.volume = 0.35; // volume moderato
      let playing = false;

      // Toggle musica al click
      btnMusic.addEventListener('click', async () => {
        try{
          if(!playing){
            await audio.play();     // alcuni browser richiedono gesto utente (qui c'è)
            playing = true;
            btnMusic.textContent = 'Musica ❚❚';
          } else {
            audio.pause();
            playing = false;
            btnMusic.textContent = 'Musica ▷';
          }
        }catch(e){
          // Se il browser blocca, mostro stato OFF
          playing = false;
          btnMusic.textContent = 'Musica ▷';
        }
      });
    })();
  </script>
</body>
</html>
