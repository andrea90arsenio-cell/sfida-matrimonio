<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sfida</title>

  <!-- Font Ex Padrian -->
  <link href="https://fonts.cdnfonts.com/css/ex-padrian" rel="stylesheet">

  <!-- Precarica lo sfondo per evitare che appaia solo dopo un refresh -->
  <link rel="preload" as="image" href="sfondo.jpg" />

  <style>
    :root { --ink:#4a3f30; }
    html, body { height: 100%; }

    /* Fallback “carta chiara” sempre visibile */
    body{
      margin:0;
      color:var(--ink);
      font-family:'Ex Padrian', Georgia, serif;
      display:grid;
      place-items:end center;       /* ancora più in basso */
      padding: 0 20px 6vh;          /* sposta il blocco più vicino al fondo */
      box-sizing:border-box;
      text-align:center;
      text-shadow:1px 1px 2px rgba(255,255,255,0.6);
      background:
        radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%);
      min-height:100vh;
    }

    /* Quando l'immagine è pronta, applico anche lo sfondo vero + overlay leggero */
    body.bg-loaded{
      background:
        linear-gradient(rgba(255,255,255,0.35), rgba(255,255,255,0.35)), /* overlay più leggero */
        url("sfondo.jpg") no-repeat center center fixed,
        radial-gradient(90% 60% at 10% -10%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        radial-gradient(90% 60% at 110% 110%, rgba(255,255,255,0.9), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#fbfaf7 0%,#f4efe7 100%);
      background-size: cover, cover, cover, cover, cover;
    }

    /* Blocco contenuti raccolto e vicino al ringraziamento */
    .stack{
      display:grid;
      gap: 10px;                    /* blocchi più compatti tra loro */
      max-width:min(820px, 100%);
      padding: 24px 12px;           /* leggero padding per respirare */
    }

    h1{
      font-size: clamp(32px, 6vw, 56px);
      margin: 0;
      font-weight: 400;
    }
    p.description{
      font-size: clamp(16px, 3.2vw, 22px);
      margin: 0;
      font-style: italic;
    }
    p.challenge{
      font-size: clamp(22px, 4.8vw, 34px);
      font-weight: 700;
      line-height: 1.25;
      margin: 8px 0 0 0;
    }

    .actions{ margin: 6px 0 0 0; }
    button{
      font: inherit;
      padding: .6em 1.2em;
      border-radius: 25px;
      border: 1px solid #c8bca8;
      background: #fff;
      cursor: pointer;
      transition: transform .1s;
    }
    button:hover{ transform: translateY(-2px); }

    p.thanks{
      font-size: clamp(14px, 3vw, 18px);
      font-style: italic;
      margin: 4px 0 0 0;           /* molto vicino al resto */
    }
  </style>
</head>
<body>
  <main class="stack">
    <h1>Sfida</h1>
    <p class="description">Un piccolo gioco per rendere la festa ancora più speciale.</p>
    <p class="challenge" id="challengeText"></p>

    <div class="actions">
      <button id="newBtn" type="button">Nuova sfida</button>
    </div>

    <p class="thanks">Grazie per partecipare e rendere questo giorno indimenticabile.</p>
  </main>

  <script>
    // Precarico lo sfondo e lo applico quando è pronto
    (function preloadBg(){
      const img = new Image();
      img.onload = () => document.body.classList.add('bg-loaded');
      img.onerror = () => {/* resta il fallback, nessun errore a schermo */};
      img.src = 'sfondo.jpg';
    })();

    // Logica "sfida"
    const challenges = [
      "Vai a fare un brindisi con uno sconosciuto.",
      "Racconta agli sposi il tuo più bel ricordo con loro.",
      "Balla la tua canzone preferita per almeno un minuto.",
      "Scatta una foto divertente con qualcuno che non conosci.",
      "Fai un complimento sincero a due persone che non conosci."
    ];

    const STORAGE_KEY = "sfida_generica";
    const loadSaved = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "null"); }
      catch { return null; }
    };
    const save = (index) => localStorage.setItem(STORAGE_KEY, JSON.stringify({ index }));
    const pickRandom = (exclude) => {
      let idx;
      do { idx = Math.floor(Math.random() * challenges.length); }
      while (idx === exclude && challenges.length > 1);
      return idx;
    };

    (function init(){
      let saved = loadSaved();
      let index = (saved && Number.isInteger(saved.index)) ? saved.index : pickRandom();
      if (!saved) save(index);

      const challengeText = document.getElementById("challengeText");
      challengeText.textContent = challenges[index];

      document.getElementById("newBtn").addEventListener("click", () => {
        index = pickRandom(index);
        save(index);
        challengeText.textContent = challenges[index];
      });
    })();
  </script>
</body>
</html>
